<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SkyCast | Animated Weather</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Lottie & fflate for TGS -->
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    <script src="https://unpkg.com/fflate@0.8.0/umd/index.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Outfit', sans-serif;
            background-color: #111;
            color: white;
            transition: background 0.8s ease;
            overflow-x: hidden;
        }

        /* Dynamic Background Gradients */
        .bg-clear { background: linear-gradient(135deg, #2980B9, #6DD5FA, #FFFFFF); } /* Brighter Clear */
        .bg-clouds { background: linear-gradient(135deg, #606c88, #3f4c6b); }
        .bg-rain { background: linear-gradient(135deg, #2b5876, #4e4376); }
        .bg-thunder { background: linear-gradient(135deg, #1f1c2c, #928dab); }
        .bg-snow { background: linear-gradient(135deg, #E0EAFC, #CFDEF3); color: #333; } /* Dark text for snow */
        .bg-mist { background: linear-gradient(135deg, #3e5151, #decba4); }
        .bg-default { background: linear-gradient(135deg, #8E2DE2, #4A00E0); }

        /* Snow text adjustments */
        .bg-snow .text-white\/70 { color: rgba(0,0,0,0.6); }
        .bg-snow .glass-panel { background: rgba(255, 255, 255, 0.4); border-color: rgba(255,255,255,0.6); }
        .bg-snow .search-bar { background: rgba(255,255,255,0.6); border-color: rgba(0,0,0,0.1); }
        .bg-snow input { color: #333; }
        .bg-snow input::placeholder { color: rgba(0,0,0,0.5); }
        .bg-snow .fa-solid { color: #444; }

        /* Glassmorphism Card */
        .glass-panel {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
            border-radius: 30px;
        }

        /* Search Bar */
        .search-bar {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50px;
            transition: all 0.3s ease;
        }
        .search-bar:focus-within {
            background: rgba(255, 255, 255, 0.3);
            box-shadow: 0 0 15px rgba(255,255,255,0.2);
        }
        ::placeholder { color: rgba(255, 255, 255, 0.6); }

        /* Animations */
        .slide-up { animation: slideUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes slideUp { 
            from { opacity: 0; transform: translateY(40px); } 
            to { opacity: 1; transform: translateY(0); } 
        }

        .pulse-slow { animation: pulse 4s infinite ease-in-out; }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Weather Stats Grid */
        .stat-box {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 20px;
            padding: 15px;
            text-align: center;
            transition: transform 0.2s;
        }
        .bg-snow .stat-box { background: rgba(255, 255, 255, 0.5); }
        .stat-box:hover { transform: translateY(-5px); }

        /* Forecast Card */
        .forecast-card {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 20px;
            padding: 16px;
            min-width: 90px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
        }
        .bg-snow .forecast-card { background: rgba(255, 255, 255, 0.5); border-color: white; }
        .forecast-card:hover { transform: scale(1.05); background: rgba(255, 255, 255, 0.2); }

        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-left-color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        .bg-snow .loading-spinner { border-color: rgba(0,0,0,0.1); border-left-color: #333; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* Custom Toast */
        .toast {
            position: fixed;
            top: 24px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: rgba(239, 68, 68, 0.9);
            backdrop-filter: blur(10px);
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 100;
        }
        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }

        /* Scrollbar Hiding */
        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="min-h-screen w-screen flex flex-col items-center justify-center p-4 bg-default transition-all duration-700" id="body-bg">

    <!-- Navbar -->
    <nav class="absolute top-0 left-0 w-full p-6 flex justify-between items-center z-10">
        <div class="flex items-center gap-2">
            <i class="fa-solid fa-cloud-bolt text-2xl drop-shadow-md"></i>
            <span class="font-bold text-xl tracking-wide drop-shadow-sm">SkyCast</span>
        </div>
        <a href="https://github.com/Zohox-Dev" target="_blank" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-full text-sm font-medium transition-all backdrop-blur-md border border-white/10 shadow-lg">
            <i class="fa-brands fa-github mr-2"></i> GitHub
        </a>
    </nav>

    <!-- Content Wrapper: Flex Column on Mobile, Row on Desktop -->
    <div class="flex flex-col lg:flex-row items-center lg:items-start justify-center gap-6 w-full max-w-6xl slide-up z-20 mt-16 lg:mt-0">

        <!-- Left Side: Main Weather Card -->
        <main class="w-full max-w-md glass-panel p-8 relative overflow-hidden shrink-0">
            
            <!-- Search -->
            <div class="relative mb-6 z-20">
                <form onsubmit="handleSearch(event)" class="search-bar flex items-center px-4 py-3">
                    <i class="fa-solid fa-magnifying-glass text-white/70 mr-3"></i>
                    <input type="text" id="city-input" placeholder="Search City..." class="bg-transparent border-none outline-none text-white w-full placeholder-white/60 font-medium">
                </form>
                <div id="loading" class="absolute right-4 top-3 hidden">
                    <div class="loading-spinner"></div>
                </div>
            </div>

            <!-- Weather Info -->
            <div class="flex flex-col items-center text-center z-20 relative">
                <h1 id="city-name" class="text-3xl font-bold mb-1 drop-shadow-sm">Colombo, LK</h1>
                <p id="date-text" class="text-white/70 text-sm font-medium mb-4">Loading date...</p>

                <!-- Animated Sticker -->
                <div class="w-64 h-64 -my-6 pulse-slow drop-shadow-2xl">
                    <lottie-player id="weather-sticker" background="transparent" speed="1" style="width: 100%; height: 100%;" loop autoplay></lottie-player>
                </div>

                <!-- Temperature -->
                <div class="mt-4">
                    <h2 class="text-8xl font-bold relative inline-block drop-shadow-md">
                        <span id="temp-val">--</span><span class="text-4xl absolute top-4 -right-8">°</span>
                    </h2>
                    <p id="weather-desc" class="text-xl font-medium mt-2 opacity-90 capitalize">Weather</p>
                </div>

                <!-- Stats -->
                <div class="grid grid-cols-3 gap-4 w-full mt-10">
                    <div class="stat-box">
                        <i class="fa-solid fa-wind text-white/70 mb-2 text-xl"></i>
                        <p class="text-lg font-bold"><span id="wind-speed">--</span> <span class="text-[10px] opacity-70 block -mt-1">km/h</span></p>
                    </div>
                    <div class="stat-box">
                        <i class="fa-solid fa-droplet text-white/70 mb-2 text-xl"></i>
                        <p class="text-lg font-bold"><span id="humidity">--</span> <span class="text-[10px] opacity-70 block -mt-1">%</span></p>
                    </div>
                    <div class="stat-box">
                        <i class="fa-solid fa-temperature-half text-white/70 mb-2 text-xl"></i>
                        <p class="text-lg font-bold"><span id="feels-like">--</span><span class="text-[10px] opacity-70 block -mt-1">Feels Like</span></p>
                    </div>
                </div>
            </div>
        </main>

        <!-- Right Side (Desktop) / Bottom (Mobile): Forecast -->
        <!-- lg:h-[650px] makes it match the main card height roughly on desktop -->
        <section class="glass-panel p-6 w-full max-w-md lg:w-80 lg:h-auto flex flex-col justify-center">
            <h3 class="text-lg font-bold mb-4 px-2 flex items-center gap-2 border-b border-white/10 pb-2">
                <i class="fa-regular fa-calendar-days"></i> 7-Day Forecast
            </h3>
            
            <!-- 
               Mobile: Flex Row (Horizontal Scroll)
               Desktop: Flex Col (Vertical List) 
            -->
            <div id="forecast-container" class="flex lg:flex-col gap-3 overflow-x-auto lg:overflow-y-auto hide-scroll pb-2 lg:pb-0 h-full">
                <!-- Forecast items will be injected here -->
            </div>
        </section>

    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <i class="fa-solid fa-circle-exclamation text-xl"></i>
        <span id="toast-message">City not found!</span>
    </div>

    <footer class="mt-8 text-white/40 text-xs font-medium z-10 pb-4">
        Powered by Open-Meteo & Zohox Dev
    </footer>

    <script>
        // --- ASSET LOADER ---
        async function loadTGS(url, elementId, weatherType) {
            const player = document.getElementById(elementId);
            
            // Updated Fallback URLs (Using reliable public assets)
            const fallbacks = {
                'clear': 'https://lottie.host/575a71dc-d309-408d-b03a-3f938d829913/7z2f4j2G7v.json',
                'clouds': 'https://lottie.host/03e58332-f248-47f1-9311-645391a99858/N1vM7Z5N8d.json', 
                'rain': 'https://lottie.host/9605333f-8c38-4e31-9745-73132644265e/D191l3Hq6g.json',
                'thunder': 'https://lottie.host/681e467d-d123-40a2-8822-e42152862c9d/a8b2Y2G1Wz.json',
                'snow': 'https://lottie.host/0b6e9447-d5d1-4191-848f-4107cb538053/k8q5yZ3j4s.json', // New Snow URL
                'mist': 'https://lottie.host/f44b2568-d065-4428-98e3-0567e9142f36/A3w2K2j0Jc.json'
            };

            try {
                // Try Local TGS first
                const response = await fetch(url);
                if (!response.ok) throw new Error('Local asset failed');
                const buffer = await response.arrayBuffer();
                const decompressed = fflate.gunzipSync(new Uint8Array(buffer));
                const json = JSON.parse(new TextDecoder().decode(decompressed));
                const blobUrl = URL.createObjectURL(new Blob([JSON.stringify(json)], {type: "application/json"}));
                if(player) player.load(blobUrl);
            } catch (e) {
                // Fallback to Online Lottie
                console.warn(`Local sticker failed for ${weatherType}, using fallback.`);
                if(player && fallbacks[weatherType]) player.load(fallbacks[weatherType]);
                else if(player) player.load(fallbacks['clouds']);
            }
        }

        // --- WEATHER LOGIC ---
        
        async function getCoordinates(city) {
            const url = `https://geocoding-api.open-meteo.com/v1/search?name=${city}&count=1&language=en&format=json`;
            const res = await fetch(url);
            const data = await res.json();
            if (!data.results) throw new Error("City not found");
            return data.results[0];
        }

        async function getWeather(lat, lon) {
            const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,apparent_temperature,is_day,weather_code,wind_speed_10m&daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=auto`;
            const res = await fetch(url);
            return await res.json();
        }

        function getWeatherType(code) {
            // WMO Codes
            if (code === 0) return 'clear';
            if (code >= 1 && code <= 3) return 'clouds';
            if ((code >= 51 && code <= 67) || (code >= 80 && code <= 82)) return 'rain';
            // Fixed Snow Codes: 71, 73, 75, 77, 85, 86
            if ((code >= 71 && code <= 77) || code === 85 || code === 86) return 'snow';
            if (code >= 95) return 'thunder';
            if (code === 45 || code === 48) return 'mist';
            return 'clouds';
        }

        function getWeatherDescription(code) {
             const codes = {
                 0: "Clear Sky", 1: "Mainly Clear", 2: "Partly Cloudy", 3: "Overcast",
                 45: "Foggy", 48: "Depositing Rime Fog",
                 51: "Light Drizzle", 53: "Moderate Drizzle", 55: "Dense Drizzle",
                 61: "Slight Rain", 63: "Moderate Rain", 65: "Heavy Rain",
                 71: "Slight Snow", 73: "Moderate Snow", 75: "Heavy Snow", 77: "Snow Grains",
                 80: "Slight Showers", 81: "Moderate Showers", 82: "Violent Showers",
                 85: "Snow Showers", 86: "Heavy Snow Showers",
                 95: "Thunderstorm", 96: "Thunderstorm + Hail", 99: "Heavy Thunderstorm"
             };
             return codes[code] || "Unknown Weather";
        }

        function getWeatherIcon(code) {
            const type = getWeatherType(code);
            const icons = {
                'clear': 'fa-sun text-yellow-400',
                'clouds': 'fa-cloud-sun text-gray-300',
                'rain': 'fa-cloud-rain text-blue-300',
                'thunder': 'fa-bolt text-yellow-300',
                'snow': 'fa-snowflake text-white',
                'mist': 'fa-smog text-gray-400'
            };
            return icons[type] || 'fa-cloud';
        }

        async function updateWeather(city) {
            const loader = document.getElementById('loading');
            
            try {
                loader.classList.remove('hidden');
                
                const location = await getCoordinates(city);
                const weatherData = await getWeather(location.latitude, location.longitude);
                const current = weatherData.current;

                // Update UI Text
                document.getElementById('city-name').innerText = `${location.name}, ${location.country_code}`;
                document.getElementById('temp-val').innerText = Math.round(current.temperature_2m);
                document.getElementById('weather-desc').innerText = getWeatherDescription(current.weather_code);
                document.getElementById('wind-speed').innerText = current.wind_speed_10m;
                document.getElementById('humidity').innerText = current.relative_humidity_2m;
                document.getElementById('feels-like').innerText = Math.round(current.apparent_temperature);
                
                const now = new Date();
                document.getElementById('date-text').innerText = now.toLocaleDateString('en-US', { weekday: 'long', hour: 'numeric', minute: 'numeric' });

                // Theme & Sticker
                const type = getWeatherType(current.weather_code);
                
                // Update BG class on Body
                const body = document.getElementById('body-bg');
                // Remove old bg classes
                body.classList.remove('bg-clear','bg-clouds','bg-rain','bg-thunder','bg-snow','bg-mist','bg-default');
                // Add new
                body.classList.add(`bg-${type}`);
                
                // Load Sticker
                loadTGS(`assets/${type}.tgs`, 'weather-sticker', type);

                // Render Forecast
                renderForecast(weatherData.daily);

            } catch (error) {
                showToast("City not found. Try again!");
                console.error(error);
            } finally {
                loader.classList.add('hidden');
            }
        }

        function renderForecast(daily) {
            const container = document.getElementById('forecast-container');
            container.innerHTML = '';

            // Using flex-col for desktop (vertical) and flex-row for mobile
            // We'll limit to 5 days for cleaner UI if needed, but 7 is fine
            for(let i = 0; i < daily.time.length; i++) {
                const dateStr = daily.time[i];
                const date = new Date(dateStr);
                const dayName = i === 0 ? "Today" : date.toLocaleDateString('en-US', { weekday: 'short' });
                const maxTemp = Math.round(daily.temperature_2m_max[i]);
                const minTemp = Math.round(daily.temperature_2m_min[i]);
                const code = daily.weather_code[i];
                const iconClass = getWeatherIcon(code);

                const card = document.createElement('div');
                // Responsive classes:
                // Mobile: min-width: 90px (Square-ish)
                // Desktop: w-full flex-row items-center (List view)
                card.className = `forecast-card group shrink-0
                                  lg:flex-row lg:w-full lg:h-16 lg:px-4 lg:py-2 lg:gap-4 lg:min-h-0`;
                
                card.innerHTML = `
                    <p class="text-sm font-bold w-12 text-left lg:w-16">${dayName}</p>
                    <i class="fa-solid ${iconClass} text-xl my-1 lg:my-0 lg:mx-auto"></i>
                    <div class="flex flex-col lg:flex-row lg:gap-2 items-center">
                        <p class="text-sm font-bold">${maxTemp}°</p>
                        <p class="text-xs opacity-60">${minTemp}°</p>
                    </div>
                `;
                container.appendChild(card);
            }
        }

        function handleSearch(e) {
            e.preventDefault();
            const city = document.getElementById('city-input').value;
            if(city) updateWeather(city);
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-message').innerText = message;
            toast.classList.add('show');
            setTimeout(() => { toast.classList.remove('show'); }, 3000);
        }

        window.addEventListener('DOMContentLoaded', () => {
            updateWeather("Colombo");
        });

    </script>
</body>
</html>
